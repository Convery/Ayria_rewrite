/*
    Initial author: Convery (tcn@ayria.se)
    Started: 2023-02-27
    License: MIT
*/

#include "Hooking.hpp"

#if defined (_MSC_VER)
#pragma section(".text")
__declspec(allocate(".text")) static constexpr uint8_t PUSHA32[] = { 0x50, 0x53, 0x51, 0x52, 0x55, 0x57, 0x56, 0xC3 };
__declspec(allocate(".text")) static constexpr uint8_t POPA32[]  = { 0x5E, 0x5F, 0x5D, 0x5A, 0x59, 0x5B, 0x58, 0xC3 };
__declspec(allocate(".text")) static constexpr uint8_t PUSHA64[] = { 0x50, 0x53, 0x51, 0x52, 0x55, 0x57, 0x56, 0x41, 0x50, 0x41, 0x51, 0x41, 0x52, 0x41, 0x53, 0x41, 0x54, 0x41, 0x55, 0x41, 0x56, 0x41, 0x57, 0xC3 };
__declspec(allocate(".text")) static constexpr uint8_t POPA64[]  = { 0x41, 0x5F, 0x41, 0x5E, 0x41, 0x5D, 0x41, 0x5C, 0x41, 0x5B, 0x41, 0x5A, 0x41, 0x59, 0x41, 0x58, 0x5E, 0x5F, 0x5D, 0x5A, 0x59, 0x5B, 0x58, 0xC3 };
#else
__attribute__((section(".text#"))) static constexpr uint8_t PUSHA32[] = { 0x50, 0x53, 0x51, 0x52, 0x55, 0x57, 0x56, 0xC3 };
__attribute__((section(".text#"))) static constexpr uint8_t POPA32[]  = { 0x5E, 0x5F, 0x5D, 0x5A, 0x59, 0x5B, 0x58, 0xC3 };
__attribute__((section(".text#"))) static constexpr uint8_t PUSHA64[] = { 0x50, 0x53, 0x51, 0x52, 0x55, 0x57, 0x56, 0x41, 0x50, 0x41, 0x51, 0x41, 0x52, 0x41, 0x53, 0x41, 0x54, 0x41, 0x55, 0x41, 0x56, 0x41, 0x57, 0xC3 };
__attribute__((section(".text#"))) static constexpr uint8_t POPA64[]  = { 0x41, 0x5F, 0x41, 0x5E, 0x41, 0x5D, 0x41, 0x5C, 0x41, 0x5B, 0x41, 0x5A, 0x41, 0x59, 0x41, 0x58, 0x5E, 0x5F, 0x5D, 0x5A, 0x59, 0x5B, 0x58, 0xC3 };
#endif

#if defined(_M_X64) || defined(__x86_64__)
void __stdcall PUSHA() { ((void (*)())&PUSHA64)(); }
void __stdcall POPA() { ((void (*)())&POPA64)(); }
#else
void __stdcall PUSHA() { ((void (*)())&PUSHA32)(); }
void __stdcall POPA() { ((void (*)())&POPA32)(); }
#endif
